define(["jquery","underscore","backbone","pages/spark/app","i18n!pages/spark/views/template/nls/sidebar","pages/spark/views/template/sidebar.html","spark/app/signature/js/signature_track"],function($,_,Backbone,Coursera,_t,template,SigtrackFunctions){var sidebar=Backbone.View.extend({name:"sidebar",className:"coursera-sidebar",attributes:{role:"menubar"},initialize:function(){},render:function(){return this.$el.html(template({_t:_t,course:Coursera.course,user:Coursera.user,navbar:Coursera.navbar,config:Coursera.config,url:encodeURIComponent(decodeURIComponent(window.location.href))})),this.updateSidebar(),SigtrackFunctions.addLastChanceModalInteraction(this.$el),this},updateSidebar:function(){function markLink(query){if(foundActiveLink)return;var matches=[];if($navbar.find(query).each(function(){matches.push($(this).parent()),foundActiveLink=!0}),1==matches.length)if(foundActiveLink=!0,-1==window.location.href.indexOf("/search?q"))matches[0].addClass("active"),matches[0].find("a").append('<span class="course-navbar-selected-marker">(selected)</span>')}this.$el.find(".course-navbar-container li").removeClass("active"),this.$el.find(".course-navbar-container li").remove(".course-navbar-selected-marker");var $navbar=this.$el.find(".course-navbar-container li"),foundActiveLink=!1;markLink('a[href="'+window.location.pathname+"/index"+window.location.search+'"]'),markLink('a[href="'+window.location.pathname+window.location.search+'"]'),markLink('a[href="'+window.location.href+'"]'),markLink('a[href="'+window.location.pathname+'"]'),markLink('a[href="'+window.location.href+'/index"]'),markLink('a[href="'+window.location.pathname+'/index"]'),markLink('a[href^="'+window.location.href.split("?")[0]+'"]')}});return sidebar});